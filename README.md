## 水分汇总

- 回潮时间中年份改回2020年
- 时间加减用 TEXT 公式: TEXT(时间相减, "[h]:mm")



## vbaDeveloper的使用

<https://github.com/hilkoc/vbaDeveloper>

手动打开vbaDeveloper.xlam, 就会出现加载项, 然后导出

**excel文件名是中文就无法导出**



##  VBA-JSON的使用

<https://github.com/VBA-tools/VBA-JSON>



## HDT烘丝入口水分

96线同步复制HDT数据(未完成)

- 从96的HDT表中遍历经典HDT, 如果64加料表有这张工单, 然后64HDT表没有这张工单, 就进行append

  

## 语音提醒

### 锚点

锚点1: 开始时间(经常容易忘记)

- 开始时间容易忘记写,需要提醒
- 提醒的是这一批次烟**开始后**需要注意的东西, 如查看入柜状态,注意变异系数, 注意精度



锚点2: 结束时间, 提醒下一批要写开始时间,

- 提醒这一批次**结束后**需要注意的地方
- 提醒下一批次**开始前**需要检查的地方
- 提醒要写下一批次的开始时间



每批烟需要有三处提醒内容, 分别是**开机前, 开机后, 结束后**



### 第一批提醒

第一批开机前需要的提醒



### 其他

加料批次的转烟时间, 同批次的转烟时间要20分钟左右, 不同批次的要分钟30左右

切烘加香第四批, 第八批需清扫



## 语音提醒函数注意点

先检查日期

1. 日期栏是今天或者空白
   - ~~时间已过, 如果isForceBroadcast 是 true , 立即进行提醒  ~~
   - 现在的时间没有超过deadLineOffset + 本来要播报的时间就进行播报
2. 日期栏过期
   - 不进行提醒


	


## 状态栏文字提醒

类似FIFO的列表



## 解决无法立即更新工作薄中的部分链接

HDT段的表先改为不保护的状态(未完成)



## 使用JSON记录语音数据

***原则: 数据不要分散放置, 不要同时修改多个地方***

牌号相关的数据, 如加料比例, 加香比例,主叶丝秤的流量, 梗丝,膨丝,残丝的掺配比例等等, 放到excel表中

语音提醒放到JSON文件中(其中柜的分类工作直接在代码中完成)



### 文件结构
```json
{
    "回潮": {

        "第一批": [Node, ...],

        "开始前": [Node, ...],

        "开始后": [Node, ...],

        "结束后": [Node, ...]
    },

    "加料": {

        "第一批": [Node, ...],

        "开始前": [Node, ...],

        "开始后": [Node, ...],

        "结束后": [Node, ...]

    },

    "切烘加香": {

        "第一批": [Node, ...],

        "开始前": [Node, ...],

        "开始后": [Node, ...],

        "结束后": [Node, ...]

    },

    "贮叶柜": {

        "叶柜":  [Node, ...],

        "HDT":  [Node, ...]

    },

    "贮丝柜": {

        "南区AF":  [Node, ...],

        "南区GM":  [Node, ...],

        "南区NT":  [Node, ...],

        "木箱AC":  [Node, ...],

        "北区AD":  [Node, ...],

        "北区EH":  [Node, ...]

    }
}
```


### Node的结构
```json
{

    "sOffsetTime": int,

    "aOffsetTime": int,

    "deadLineOffset": int,
    
    "filter": array,

    "redirectList": array, 

    "content": string 

}
```

deadLineOffset +本来应播报的时间就是最后需要播报该语音的时间

sOffsetTime与aOffsetTime两者只会有一

sOffsetTime是固定的偏移时间

aOffsetTime则需要经过主叶丝秤流量进行变换(输送带的速度没有改变, 主要是填满主叶丝暂存柜需要的时间不同)

filter是content或redirectList只应用于filter内的牌号,如果没有filter这一项, 则所有牌号都使用

redirectList, 与content二者只会有一

​	存在redirectList. 用redirectList, 牌号找到需要的参数, 用参数生成新的内容

​	存在content. 直接使用



### 其他注意点

JSON 文件的编码需要是 ANSI, 否则中文会变为乱码且无法正确解析



## 如何改变偏移时间

***使用双喜(经典)的偏移时间作为基准***

主叶丝秤之后的语音偏移时间才需要改变



## Error的处理



## 可能存在的Bug

晚上加班可能会让时间函数判断不用提醒



## 高亮选中行和列

### 序号为第5, 9, 则为true

#### 列
```
AND(CELL("col") = COLUMN(), OR(INDIRECT(ADDRESS(CELL("row"), 2)) = 5, INDIRECT(ADDRESS(CELL("row"), 2)) = 9))
```
#### 行
```
AND(CELL("row") = ROW(), OR($B2 = 5, $B2 = 9))
```
### 序号不是第5, 9, 则为true

#### 列
```
AND(CELL("col")=COLUMN(), AND(INDIRECT(ADDRESS(CELL("row"), 2)) <> 5, INDIRECT(ADDRESS(CELL("row"), 2)) <> 9))
```
#### 行
```
AND(CELL("row")=ROW(), $B2 <> 5, $B2 <> 9)
```



## 解决其他表插入列后会令水分汇总表数据错乱的问题

vlookup写对了可以自动应对插入列的问题

首先第二个参数"寻找的范围"可以自动更新

第三个参数使用 colum(表名!单元格1) - colum(表名!单元格2) + 1 也能进行自动更新



## 烘丝料头温度的升温过程
1. 起始点温度知道
2. 最终温度在变化(变化不大)
3. 升温时间已知
3. 温度惯性较大, 升温过程需要先快后慢



## NEXT

1. offset时间精确到秒
2. ~~水分汇总用vba代码（查看解决其他表插入列后会令水分汇总表数据错乱的问题)~~
3. ~~语音逻辑增加filter功能~~
4. ~~状态栏文字提醒加上时间~~(时间格式不一样)
5. ~~修改cleanContent函数, 把文字颜色也清除掉~~
6. 取消提醒(?)
7. 提醒的过期逻辑需要重新思考
8. ~~切烘加香表加一栏加料出口水分~~
9. ck1的转换

